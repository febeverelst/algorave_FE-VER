<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Passion Project Blog</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
    <div class="container">
        <nav class="navbar">
            <a href="#" class="nav-brand" onclick="loadPage('home'); return false;">PP: FE_VER</a>
            <ul class="nav-menu">
                <li><a href="#" class="nav-link" data-page="snippets" onclick="loadPage('snippets'); return false;">Code
                        Snippets</a></li>
                <li><a href="#" class="nav-link" data-page="cookbook"
                        onclick="loadPage('cookbook'); return false;">Cookbook</a></li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="blog" onclick="loadPage('blog', 'all'); return false;">Daily
                        Log</a>
                    <ul class="nav-dropdown" id="weekDropdown">
                        <li><a href="#" class="dropdown-link" onclick="loadPage('blog', 'week-1'); return false;">Week
                                1</a></li>
                        <li><a href="#" class="dropdown-link" onclick="loadPage('blog', 'week-2'); return false;">Week
                                2</a></li>
                        <li><a href="#" class="dropdown-link" onclick="loadPage('blog', 'week-3'); return false;">Week
                                3</a></li>
                        <li><a href="#" class="dropdown-link" onclick="loadPage('blog', 'week-4'); return false;">Week
                                4</a></li>
                        <li><a href="#" class="dropdown-link" onclick="loadPage('blog', 'week-5'); return false;">Week
                                5</a></li>
                        <li><a href="#" class="dropdown-link" onclick="loadPage('blog', 'week-6'); return false;">Week
                                6</a></li>
                        <li><a href="#" class="dropdown-link" onclick="loadPage('blog', 'week-7'); return false;">Week
                                7</a></li>
                        <li><a href="#" class="dropdown-link" onclick="loadPage('blog', 'week-8'); return false;">Week
                                8</a></li>
                        <li><a href="#" class="dropdown-link" onclick="loadPage('blog', 'week-9'); return false;">Week
                                9</a></li>
                        <li><a href="#" class="dropdown-link" onclick="loadPage('blog', 'week-10'); return false;">Week
                                10</a></li>
                        <li><a href="#" class="dropdown-link" onclick="loadPage('blog', 'week-11'); return false;">Week
                                11</a></li>
                        <li><a href="#" class="dropdown-link" onclick="loadPage('blog', 'week-12'); return false;">Week
                                12</a></li>
                        <li><a href="#" class="dropdown-link" onclick="loadPage('blog', 'week-13'); return false;">Week
                                13</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
        <aside class="sidebar" id="sidebar">
            <div class="toc" id="toc"></div>
        </aside>
        <main class="content" id="content">
        </main>
    </div>

    <!-- Scripts -->
    <script>
        let currentPage = 'home';
        let currentWeek = 'all';

        function generateTOC() {
            const content = document.getElementById('content');
            const headings = content.querySelectorAll('h2');
            const toc = document.getElementById('toc');
            toc.innerHTML = '<h3>Table of Contents</h3><ul></ul>';
            const ul = toc.querySelector('ul');

            headings.forEach((heading, index) => {
                const id = `section-${index}`;
                heading.id = id;
                const li = document.createElement('li');
                const a = document.createElement('a');
                a.href = `#${id}`;
                a.textContent = heading.textContent;
                a.addEventListener('click', (e) => {
                    e.preventDefault();
                    const offset = 90; // Offset to keep title visible
                    const elementPosition = heading.getBoundingClientRect().top + window.pageYOffset;
                    window.scrollTo({ top: elementPosition - offset, behavior: 'smooth' });
                });
                li.appendChild(a);
                ul.appendChild(li);
            });

            document.getElementById('sidebar').style.display = 'block';
            document.body.classList.add('sidebar-active');
        }

        async function loadPage(page, week = null) {
            currentPage = page;
            if (week) currentWeek = week;

            // Save current page state to localStorage
            localStorage.setItem('currentPage', page);
            if (week) localStorage.setItem('currentWeek', week);

            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            if (page === 'blog') {
                document.querySelector(`[data-page="blog"]`)?.classList.add('active');
            } else {
                document.querySelector(`[data-page="${page}"]`)?.classList.add('active');
            }

            try {
                let filename;
                if (page === 'home') filename = 'home.md';
                else if (page === 'snippets') filename = 'snippets.md';
                else if (page === 'cookbook') filename = 'cookbook.md';
                else if (page === 'blog') {
                    if (week && week !== 'all') filename = `weeks/${week}.md`;
                    else filename = 'blog-summary.md';
                }

                const response = await fetch(filename);
                if (!response.ok) throw new Error('File not found: ' + filename);
                const markdown = await response.text();
                const html = marked.parse(markdown);
                document.getElementById('content').innerHTML = html;
                window.scrollTo(0, 0);

                // Generate TOC for week pages and cookbook
                if ((page === 'blog' && week && week !== 'all') || page === 'cookbook') {
                    generateTOC();
                } else {
                    document.getElementById('sidebar').style.display = 'none';
                    document.body.classList.remove('sidebar-active');
                }

            } catch (error) {
                document.getElementById('content').innerHTML = `<div class="error">Error loading page: ${error.message}</div>`;
            }

            // Handle table row clicks for week links
            setTimeout(() => {
                document.querySelectorAll('a[href^="#week-link-"]').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const weekNum = link.href.split('#week-link-')[1];
                        loadPage('blog', `week-${weekNum}`);
                    });
                });
            }, 100);
        }

        window.addEventListener('load', () => {
            // Check if there's a saved page state in localStorage
            const savedPage = localStorage.getItem('currentPage');
            const savedWeek = localStorage.getItem('currentWeek');

            if (savedPage && savedPage !== 'home') {
                loadPage(savedPage, savedWeek);
            } else {
                loadPage('home');
            }
        });
    </script>
</body>

</html>